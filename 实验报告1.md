# homework1
## 实验目的
- 如何配置无人值守安装iso并在Virtualbox中完成自动化安装
- Virtualbox安装完Ubuntu之后新添加的网卡如何实现系统开机自动启用和自动获取IP
- 如何使用sftp在虚拟机和宿主机之间传输文件
## 实验环境
- Macbook Pro
- linux ubuntu18.04.1-server
## 实验过程
- 在virtualbox中安装ubuntu18.04-server
- 创建镜像
	- 从官网下载镜像
	![](https://github.com/CUCCS/linux-2019-PcoateChen/blob/homework1/img/3.png?raw=true)
	- 创建用于挂载镜像的目录
	- 挂载镜像到该目录
	- 创建工作目录用于克隆光盘内容
	- 同步光盘内容到工作目录
	- 卸载iso镜像
	![](https://github.com/CUCCS/linux-2019-PcoateChen/blob/homework1/img/4.1.png?raw=true)
	- 进入工作目录 为ubuntu安装引导界面增加一个新的菜单入口
	![](https://github.com/CUCCS/linux-2019-PcoateChen/blob/homework1/img/4.png?raw=true)
	- 在preseed目录中下载配置好的seed
	![](https://github.com/CUCCS/linux-2019-PcoateChen/blob/homework1/img/5.png?raw=true)
	- 重新生成md5sum.txt
	![](https://github.com/CUCCS/linux-2019-PcoateChen/blob/homework1/img/6.png?raw=true)
	- 建立shell脚本并运行生成无人值守镜像
	![](https://github.com/CUCCS/linux-2019-PcoateChen/blob/homework1/img/7.png?raw=true)
	![](https://github.com/CUCCS/linux-2019-PcoateChen/blob/homework1/img/8.png?raw=true)
	![](https://github.com/CUCCS/linux-2019-PcoateChen/blob/homework1/img/10.png?raw=true)
- 建立ssh服务器
	- 手动添加第二块网卡并获取IP地址
	![](https://github.com/CUCCS/linux-2019-PcoateChen/blob/homework1/img/9.png?raw=true)
	- 安装ssh服务
	![](https://github.com/CUCCS/linux-2019-PcoateChen/blob/homework1/img/11.png?raw=true)
- 从ssh服务器上将镜像下载至本地
	![](https://github.com/CUCCS/linux-2019-PcoateChen/blob/homework1/img/12.png?raw=true)
- 自动安装
	![](https://github.com/CUCCS/linux-2019-PcoateChen/blob/homework1/img/15.png?raw=true)
## 问题与思考
- 因为很多命令需要root权限，一开始我使用了root账户进行制作镜像。制作完成后却发现主机登陆服务器root账户需要权限。然而我在修改了服务器root账户登陆权限，即`PremitRootLogin = No`之后仍无法登陆，遂重新在普通账户下制作镜像。普通账号在制作时很多操作需要加上`sudo`赋予权限。但未明白修改权限后仍无法连接的原因。
## 参考
- [无人值守Linux安装镜像制作（2学时）：定制用户名和默认密码、定制安装OpenSSH Server、安装过程禁止自动联网更新软件包等](http://sec.cuc.edu.cn/huangwei/course/LinuxSysAdmin/chap0x01.exp.md.html#/title-slide "无人值守Linux安装镜像制作（2学时）：定制用户名和默认密码、定制安装OpenSSH Server、安装过程禁止自动联网更新软件包等")
